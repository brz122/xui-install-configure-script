# xui-install-configure-script
Данный скрипт произведет установку панели 3x-ui из официального репозитория автора:\
https://github.com/MHSanaei/3x-ui  

Помимо установки панели, будет произведена базовая настройка сервера, а именно:
- отключена возможность зайти по ssh для пользователя root
- порт ssh будет изменен, а также закрыт по умолчанию, для открытия порта используется port knocking\
Linux/MacOS: утилита knock\
Windows: стучаться будем скриптом\
Команда для knock и скрипт для Windows будут выведены скриптом.
- cоздан отдельный пользователь с правами sudo для доступа на сервер по ssh
- выпущены сертификаты от Let's Encrypt
- обновления безопасности Ubuntu, панель 3x-ui, а также сертификаты - будут автоматически обновляться systemd сервисом
- включен BBR в меню 3x-ui

Требования перед установкой:
1. VPS сервер в Европе с ОС Ubuntu 22.04 или новее. Рекомендуемые страны - Эстония, Германия, Нидерланды, Швейцария. Установка должна производиться на чистую ОС.
2. Наличие DNS A записи для ip адреса VSP сервера. Бесплатный домен 3 уровня с А записью можно получить у [DUCK DNS](https://www.duckdns.org/). Залогиниться можно через google аккаунт (если переживаете, создайте отдельный google аккаунт).

Примеры хостингов для покупки VPS с карты МИР (СБП):
- [WeaselCloud](https://my.weasel.cloud/)
- [Inferno Solutions](https://cp.inferno.name/index.php)
- [is*hosting](https://my.ishosting.com/ru)
- [PQ.Hosting](https://bill.pq.hosting/)
- [Aeza](https://aeza.net/)

Выполнить команду на VPS сервере:
```
/bin/bash <(curl -Ls https://raw.githubusercontent.com/maou0/xui-install-configure-script/refs/heads/main/xui-install-configure.sh)
```
Будет запрошен домен, введите домена вида: example.duckdns.org\
Затем будет запрощено подтверждение, отвечайте: y

Дождитесь завершения установки и сохраните в надежное место все данные, которые предоставит скрипт:
![image](https://github.com/user-attachments/assets/eab96115-bebd-4617-91a5-1d83ef660d43)

Теперь в панель можно попасть по ссылке: https://blockerino.duckdns.org:34067/g5tjP4tk1IWwCKA  
Соединение уже будет безопасным, с использованием ssl сертификата.\
Логины, пароли, а также адрес и порт панели генерируются случайный образом при каждой установке, поэтому не обязательно их менять.

Заходите в панель и сделайте 2 настройки:
1. Перейдите Xray Configs -> Basics -> Basic Routing, добавьте опцию 'Russia' в поле 'Block IPs' и опции 'Russia', '.ru' в поле 'Block Domains'. После этого нажмите кнопки 'Save' и 'Restart Xray' вверху страницы.

![image](https://github.com/user-attachments/assets/c8ca165e-7369-4b42-b9e4-515adf36296c)

2. Теперь надо выбрать сайт для маскировки. По завершению скрипта приведены сайты, которые можно использовать, но при желании также можно подобрать сайт самостоятельно.\
Критериев подбора 2:
- сайт не должен быть заблокирван в России (у вас должна быть возможность его открыть без средств обхода блокировок)
- сайт должен находиться в той же зоне, что и VPS сервер. Например, для Эстонского VPS надо искать сайт в зоне .ee
- задержка на VPS сервере до сайта не должна быть высокой (найти с сайт с задержкой менее 5ms довольно просто)
- подобрать популярный сайт для определенной страны можно через [сервиc](https://ahrefs.com/websites)

![image](https://github.com/user-attachments/assets/6865bc5f-351e-41a4-8db9-dd1649ebf74c)

3. Перейдите в Inbounds, нажмите add inbound.
4. В появившемся окне поменяйте значения:
- Remark: любое название, для удобства обычно называю по имени хостинг провайдера и страны, где арендован VPS сервер
- Listen IP: ip адрес VPS сервера, на котором запускался скрипт
- Port: 443
- Security: выбираем Reality, после этого у нас в блоке Client появится выбор параметра Flow
- Раскрываем блок Client, в поле Email пишем что угодно, для удобства можно писать имя устройства (iPhone, Notebook, LenovoTablet), в поле Flow выбираем xtls-rprx-vision
- Dest (Target): доменное имя сайта, под который маскируемся, с портом 443, например, для сайта https://eki.ee это будет eki.ee:443
- SNI: например, для сайта https://eki.ee это будет eki.ee,www.eki.ee
- Нажимаем большую кнопку Get New Cert
- Остальные параметры оставляем без изменений и жмем кнопку Create

![image](https://github.com/user-attachments/assets/00451bf6-4eb8-40cc-8f8d-d1c75f489665)
![image](https://github.com/user-attachments/assets/19a7914d-952f-40d2-ae14-80f74cad3405)

5. Для каждого устройства рекомендуется создать дополнительного клиента. Для этого в разделе Inbounds находим в списке только что созданный  Inbound (он у нас всего один) и нажимаем на 3 точки под столбцом Menu -> Add Client
![image](https://github.com/user-attachments/assets/dd127929-8f9a-45c5-bd71-17cf7bfd9c6d)

6. В появившемся окне в поле Email пишем название устройства (iPhone, Notebook, LenovoTablet), а в поле Flow выбираем xtls-rprx-vision и нажимаем Add Client

![image](https://github.com/user-attachments/assets/1cc65790-d15c-424e-baf8-44985ef4c788)

7. (Необязательно) Чтобы сделать подключение к нашему VPS серверу еще безопасней, можно отключить возможность входа по паролю и ходить по ключам. Но учтите, что в случае утери ключа (например, при переустановке ОС) вы потеряете доступ к серверу по ssh.
Linux/MacOS: вводим следующие команды в терминал (вторая команда будет отличаться, подставьте свои значения)
```
ssh-keygen -t ed25519
knock 45.82.253.40 11001 12002 13003 -d 500 && ssh-copy-id -p 26007 qogprthd@45.82.253.40
```
Теперь заходим на сервер по ключу:
```
knock 45.82.253.40 11001 12002 13003 -d 500 && ssh -p 26007 qogprthd@45.82.253.40
```
Вводим команду:
```
sudo -i

```

На этом настройка сервера завершена, теперь 

